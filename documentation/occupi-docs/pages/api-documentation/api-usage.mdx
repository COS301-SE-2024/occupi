# Api Usage

This page provides a detailed explanation of how to use the Occupi API.
The Occupi API is a RESTful API that allows you to interact with the Occupi platform programmatically.
The API provides endpoints for creating, reading, updating, and deleting resources.
The API also allows you to retrieve information about these resources.

# Table of Contents

- [Api Usage](#api-usage)
- [Table of Contents](#table-of-contents)
  - [Base URL](#base-url)
  - [Api](#api)
    - [Resources](#resources)
    - [Book Room](#BookRoom)
    - [View Bookings](#ViewBookings)
    - [View Rooms](#ViewRooms)
    - [Cancel Booking](#CancelBooking)
    - [Check In](#CheckIn)
    - [Get Users](#Get-users)
    - [Get Notifications](#Get-notifications)
    - [Get push tokens](#Get-push-tokens)
    - [UpdateSecuritySettings](#UpdateSecuritySettings)
    - [Get User Details](#GetUserDetails)
    - [Update User Details](#UpdateUserDetails)
    - [Get Security Settings](#GetSecuritySettings)
    - [Update Notification Settings](#UpdateNotificationSettings)
    - [Get Notification Settings](#GetNotificationSettings)

## Api

The API endpoints are used to interact with the Occupi platform. Mainly GET, POST, PUT, DELETE requests are used.

### Resources

The resources endpoints are used to create, read, update, and delete resources.

- **URL**

  `/api/resources`

- **Method**

  `GET`

- **Success Response**

  - **Code:** 200
  - **Content:** `{ "message": "Resources fetched successfully" }`

- **Error Response**

  - **Code:** 400
  - **Content:** `{ "message": "Bad Request" }`

- **Error Response**
  - **Code:** 500
  - **Content:** `{ "message": "Internal server error" }`

**_Example json to send:_**

```json copy
{}
```

### BookRoom

This endpoint is used to book a room in the Occupi system. The client needs to provide the room ID,
slot, a list of email addresses, the creator's email, and the floor number.
Upon a successful booking, a unique booking ID is generated, and a confirmation email is sent to all specified recipients.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/book-room`

- **Method**

  `POST`

- **Request Body**

- **Content**

```json copy
{
    "roomId": "string",
    "emails": ["string"],
    "creator": "string",
    "floorNo": "integer",
    "date": "string",
    "start": "string",
    "end": "string"
}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully booked!", "data": {"1234567890"}, }`

**Error Response**

- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"missing field required: <name of field>"}, }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to save booking", "error": {"code":"INTERNAL_SERVER_ERROR","details":"Failed to save booking","message":"Failed to save booking"} }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to send confirmation emails", "error": {"code":"INTERNAL_SERVER_ERROR","details":"Failed to send confirmation emails","message":"Failed to send confirmation emails"} }`

### ViewBookings

This endpoint is used to view all bookings made by a user. The client needs to provide the user's email address.
Upon a successful request, a list of all bookings made by the user is returned.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/view-bookings`

- **Method**
    
    `GET`

- **Request Body**

- **Content**

```json copy
{
    "operator": "eq", // eq, ne, gt, gte, lt, lte, in, nin default to eq
    "filter": {
        "email": "test@example.com" // the email is required
    },
    "order_asc": "creator", // column to sort in ascending order
    "order_desc": "floor", // column to sort in descending order
    "projection": ["floor"], // this is which columns you want returned
    "limit": 50, // default is 50 and is the maximum
    "page": 1 // default is 1, but can be incremented to get the next page
}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully fetched bookings!", "data": null }`

**Error Response**
    
- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"Expected Email Address"}, }`
 

**Error Response**
     
- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to get bookings", "error": {"code":"INTERNAL_SERVER_ERROR","details":"Failed to get bookings","message":"Failed to get bookings"} }`

### View Rooms

This endpoint is used to view all rooms in the Occupi system.
Upon a successful request, a list of all rooms is returned.

- **URL**

  `/api/view-rooms`

- **Method**
    
    `GET`

- **Request Body**

- **Content**

```json copy
{
    "operator": "eq", // eq, ne, gt, gte, lt, lte, in, nin default to eq
    "filter": {
        "floorNo": 3 // this is a filter to filter by
    },
    "order_asc": "description", // column to sort in ascending order
    "order_desc": "floor", // column to sort in descending order
    "projection": ["floor"], // this is which columns you want returned
    "limit": 50, // default is 50 and is the maximum
    "page": 1 // default is 1, but can be incremented to get the next page
}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully fetched bookings!", "data": null }`

**Error Response**
    
- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"Expected Email Address"}, }`
 

**Error Response**
     
- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to get bookings", "error": {"code":"INTERNAL_SERVER_ERROR","details":"Failed to get bookings","message":"Failed to get bookings"} }`

### CancelBooking

This endpoint is used to cancel a booking made by a user. 
The client needs to provide the booking ID and the person who booked.
Upon a successful request, the booking is canceled, and a confirmation email is sent to all recipients.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/cancel-booking`

- **Method**
    
    `POST`

- **Request Body**

- **Content**

```json copy
{  
    "bookingId": "string",
    "roomId": "string",
    "emails": ["string"],
    "creator": "string",
    "floorNo": "integer",
    "date": "string",
    "start": "string",
    "end": "string"
}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully cancelled booking!", "data":null }`

**Error Response**

- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"missing field required: <name of field>"}, }`

**Error Response**

- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"Invalid JSON payload"}, }`

**Error Response**

- **Code:** 404
- **Content:** `{ "status":  404, "message": "Booking not found", "error": {"code":"BAD_REQUEST","details":null,"message":"Booking not found"}, }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to cancel booking", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to save booking"} }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to send confirmation emails", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"An error occured"} }`

                              
### CheckIn

This endpoint is used to check-in a user who has booked a room.
The client needs to provide the booking ID and their email.
Upon a successful request, the user is checked in.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/check-in`

- **Method**
    
    `POST`

- **Request Body**

- **Content**

```json copy
{  
    "bookingId": "string",
    "email": "string"
}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully checked in!", "data":null }`

**Error Response**

- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"missing field required: <name of field>"}, }`


**Error Response**

- **Code:** 404
- **Content:** `{ "status":  404, "message": "Booking not found", "error": {"code":"BAD_REQUEST","details":null,"message":"Booking not found"}, }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to check in", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to checkin"} }`

### ViewRooms

This endpoint is used to view all rooms in the Occupi system.
Upon a successful request, a list of all rooms is returned.
If there are any errors during the process, appropriate error messages are returned.
Pass floorNo as a query parameter to get rooms on a specific floor. If floorNo is not provided, all rooms on floor 0 are returned.

- **URL**

  `/api/view-rooms?floorNo=0`

- **Method**
    
    `GET`
    
- **Request Body**

- **Content**

```json copy
{}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully fetched rooms!", "data": {"list of all rooms"} }`

**Error Response**

- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"missing field required: <name of field>"}, }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to get rooms", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to get rooms"} }`

### GetUserDetails

This endpoint is used to view the details of a user in the Occupi system.
Upon a successful request, the details of the user are returned.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/user-details?email=jane.doe@example.com`

- **Method**
    
    `GET`

- **Request Body**

- **Content**

```json copy
{
  "email": "string"
}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully fetched user details!", "data": {"user details"} }`

**Error Response**

- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"missing field required: <name of field>"}, }`

**Error Response**

- **Code:** 404
- **Content:** `{ "status":  404, "message": "User not found", "error": {"code":"BAD_REQUEST","details":null,"message":"User not found"} }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to get user details", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to get user details"} }`

### UpdateUserDetails

This endpoint is used to update the details of a user in the Occupi system.
The client needs to provide the user's email address and the details to be updated.
Upon a successful request, the user's details are updated.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/update-user`

- **Method**
    
    `PUT`


- **Request Body**

- **Content**
- Add fields that you want to update. Always include email field.

```json copy
{
  "email": "John.Doe@example.com",
  "details": {
    "contactNo": "123456789",
    "dob": "1970-01-01T00:00:00Z",
    "gender": "Male",
    "name": "John Doea",
    "pronouns": "He/him"
  },
  "notifications": {
    "allow": true,
    "booking_reminder": false,
    "max_capacity": true
  },
  "security": {
    "2fa": false,
    "biometrics": true
  },
  "position": "Head of Examples"
}
```

**Success Response**

- **Code:** 200
- **Content:** `{ "status":  200, "message": "Successfully updated user details!", "data": nil }`

**Error Response**

- **Code:** 400
- **Content:** `{ "status":  400, "message": "Invalid request payload", "error": {"code":"BAD_REQUEST","details":null,"message":"missing field required: <name of field>"}, }`

**Error Response**

- **Code:** 404
- **Content:** `{ "status":  404, "message": "User not found", "error": {"code":"BAD_REQUEST","details":null,"message":"User not found"} }`

**Error Response**

- **Code:** 500
- **Content:** `{ "status":  500, "message": "Failed to update user details", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to update user details"} }`

### Get Users

This endpoint is used to get users in the Occupi system.
The client can provide a filter criteria if they want to.
Upon a successful request, a list of users that match the filter criteria is returned.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/get-users`

- **Method**
    
    `GET`

- **Request Body**

- **Content**

```json copy
{
    "operator": "eq", // eq, ne, gt, gte, lt, lte, in, nin default to eq
    "filter": {
        "onSite": true // this is a filter to filter by
    },
    "order_asc": "role", // column to sort in ascending order
    "order_desc": "email", // column to sort in descending order
    "projection": ["email", "role"], // this is which columns you want returned
    "limit": 50, // default is 50 and is the maximum
    "page": 1 // default is 1, but can be incremented to get the next page
}

```
or as a url(note that the order in which you place the parameters does not matter, place them as you please)
```copy
https://dev.occupi.tech/api/filter-users?filter={"onSite": true}&projection=email,role&limit=50&page=1
```

**Success Response**

- **Code:** 200

- **Content:** `{ "status":  200, "message": "Successfully fetched users!", "data": ["list of all users"], "meta": {"currentPage": 1,"totalPages": 20,"totalResults": 7}, }`

**Error Response**

- **Code:** 500

- **Content:** `{ "status":  500, "message": "Failed to get users", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to get users"} }`

### Get Notifications

This endpoint is used to get notifications in the Occupi system.
The client can provide a filter criteria if they want to.
Upon a successful request, a list of notifications that match the filter criteria is returned.
If there are any errors during the process, appropriate error messages are returned.

- **URL**

  `/api/get-notifications`

- **Method**
    
    `GET`

- **Request Body**

- **Content**

```json copy
{
    "operator": "eq", // eq, ne, gt, gte, lt, lte, in, nin default to eq
    "filter": {
        "emails": ["test@example.com"] // this is a filter to filter by
    },
    "order_asc": "message", // column to sort in ascending order
    "order_desc": "title", // column to sort in descending order
    "projection": ["message", "title", "unreadEmails"], // this is which columns you want returned
    "limit": 50, // default is 50 and is the maximum
    "page": 1 // default is 1, but can be incremented to get the next page
}

```
or as a url(note that the order in which you place the parameters does not matter, place them as you please)
```copy
https://dev.occupi.tech/api/get-notifications?filter={"emails": ["test@example.com"]}&projection=message,title,unreadEmails&limit=50&page=1
```

**Success Response**

- **Code:** 200

- **Content:** `{ "status":  200, "message": "Successfully fetched notifications!", "data": ["list of all notifications"], "meta": {"currentPage": 1,"totalPages": 20,"totalResults": 7}, }`

**Error Response**

- **Code:** 500

- **Content:** `{ "status":  500, "message": "Failed to get notifications", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to get notifications"} }`

### Get push tokens

This endpoint is used to get the expo push tokens for the given emails

- **URL**

  `/api/get-push-tokens`

- **Method**
    
    `GET`

- **Request Body**

- **Content**

```json copy
{
  "emails": ["test@example.com"]
}

```
or as a url(note that the order in which you place the parameters does not matter, place them as you please)
```copy
https://dev.occupi.tech/api/get-push-tokens?emails=test@example.com,test1@example.com,test2@example.com
```

**Success Response**

- **Code:** 200

- **Content:** `{ "status":  200, "message": "Successfully fetched tokens!", "data": ["list of all tokens"] }`

**Error Response**

- **Code:** 500

- **Content:** `{ "status":  500, "message": "Failed to get tokens", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to get tokens"} }`

### UpdateSecuritySettings

This endpoint is used to update the security settings of a user in the Occupi system.

- **URL**

  `/api/update-security-settings`

- **Method**
    
    `POST`

- **Request Body**

- **Content**

```json copy
{
  "email": "test@example.com", // required
  "2fa": "on", // optional "on" or "off"
  "currentPassword": "password", // required if "newPassword" and "newPasswordConfirm" are provided
  "newPassword": "newPassword", // required if "currentPassword" and "newPasswordConfirm" are provided
  "newPasswordConfirm": "newPassword" // required if "currentPassword" and "newPassword" are provided
}
```

**Success Response**

- **Code:** 200

- **Content:** `{ "status":  200, "message": "Successfully updated security settings!", "data": null }`

**Error Response**

- **Code:** 500

- **Content:** `{ "status":  500, "message": "Internal server error", "error": {"code":"INTERNAL_SERVER_ERROR","details":null,"message":"Failed to update settings"} }`

